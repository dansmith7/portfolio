# Как ускорить подключение к Supabase

## Что уже сделано в коде

✅ **Кэширование на клиенте** — данные кэшируются на 1 минуту в памяти браузера  
✅ **Оптимизация запросов** — выбираются только нужные поля (меньше данных = быстрее)  
✅ **Таймауты** — запросы не висят дольше 3–5 секунд  
✅ **Параллельная загрузка** — проект и медиа загружаются одновременно

---

## Что можно сделать дополнительно

### 1. Проверить регион Supabase проекта

Если ваш проект в США/Европе, а пользователи в России/СНГ — будет задержка.

**Как проверить:**
1. Откройте [supabase.com](https://supabase.com) → ваш проект
2. **Settings → General → Region**
3. Если там `us-east-1` или `eu-west-1` — это далеко от России

**Что делать:**
- Для новых проектов выбирайте ближайший регион (например, `ap-southeast-1` для Азии)
- Для существующих проектов регион нельзя изменить — нужно создать новый проект и перенести данные

---

### 2. Оптимизировать изображения перед загрузкой

Большие изображения (5–10 МБ) будут грузиться медленно независимо от Supabase.

**Рекомендации:**
- Сжимайте изображения перед загрузкой в админке
- Используйте формат WebP вместо JPG (меньше размер при том же качестве)
- Максимальный размер: **1–2 МБ на изображение**

**Инструменты для сжатия:**
- [TinyPNG](https://tinypng.com) — онлайн-сжатие
- [Squoosh](https://squoosh.app) — конвертация в WebP
- macOS: встроенный Preview → Export → уменьшить качество

---

### 3. Добавить индексы в базу данных

Если проектов много (100+), добавьте индексы для ускорения поиска.

**Выполните в Supabase → SQL Editor:**

```sql
-- Индекс для поиска проектов по slug (уже должен быть через UNIQUE)
CREATE INDEX IF NOT EXISTS idx_projects_slug ON public.projects(slug);

-- Индекс для фильтрации show_on_home
CREATE INDEX IF NOT EXISTS idx_projects_show_on_home ON public.projects(show_on_home) WHERE show_on_home = true;

-- Индекс для сортировки по дате
CREATE INDEX IF NOT EXISTS idx_projects_created_at ON public.projects(created_at DESC);

-- Индекс для медиа по project_id
CREATE INDEX IF NOT EXISTS idx_project_media_project_id ON public.project_media(project_id);
```

---

### 4. Использовать CDN для статики (Storage)

Supabase Storage автоматически использует CDN, но можно настроить кэширование.

**В админке при загрузке файла:**
- Уже установлено `cacheControl: '3600'` (1 час)
- Можно увеличить до `'86400'` (24 часа) для редко меняющихся изображений

---

### 5. Мониторинг производительности

**Проверьте в Supabase:**
1. **Database → Query Performance** — посмотрите, какие запросы медленные
2. **Logs → API Logs** — проверьте время ответа запросов

Если запросы к БД занимают >500 мс — проблема в базе данных (нужны индексы или оптимизация запросов).

---

## Текущие настройки производительности

- **Кэш:** 1 минута (60 секунд)
- **Таймаут проекта:** 3 секунды
- **Таймаут списка:** 5 секунд
- **Параллельная загрузка:** включена

Если после всех оптимизаций загрузка всё ещё медленная (>3 сек), вероятные причины:
1. Медленное интернет-соединение
2. Очень большие изображения (>5 МБ)
3. Регион Supabase далеко от вас
4. Проблемы с сетью провайдера

---

## Быстрая проверка

Откройте консоль браузера (F12) → вкладка **Network** → обновите страницу проекта. Посмотрите:
- Сколько времени занимает запрос к `projects` (должно быть <500 мс)
- Сколько времени занимает загрузка изображений (зависит от размера файлов)

Если запрос к БД занимает >1 секунды — проблема в Supabase/сети.  
Если изображения грузятся >3 секунд — проблема в размере файлов или сети.
